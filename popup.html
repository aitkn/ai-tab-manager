<!DOCTYPE html>
<!--
  AI Tab Manager - Copyright (c) 2025 AI Tech Knowledge LLC
  Proprietary License - See LICENSE file
  support@aitkn.com
-->
<html>
<head>
  <meta charset="utf-8">
  <title>AI Tab Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <div class="header-container">
      <h1 class="header-title">
        <img src="icon48.png" alt="AI" class="header-icon">
        <span class="title-text">Tab Manager</span>
      </h1>
      <div class="header-actions">
        <a href="https://buymeacoffee.com/aitkn" target="_blank" class="support-btn" title="Support Development">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M2,21H20V19H2M20,8H18V5H20M20,3H4V13A4,4 0 0,0 8,17H14A4,4 0 0,0 18,13V10H20A2,2 0 0,0 22,8V5C22,3.89 21.1,3 20,3Z" />
          </svg>
          <span>Support</span>
        </a>
        <button id="openInTabBtn" class="tab-mode-btn" title="Open in Tab" type="button" style="display: none;">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M14,3V5H17.59L7.76,14.83L9.17,16.24L19,6.41V10H21V3M19,19H5V5H12V3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19Z" />
          </svg>
        </button>
        <button id="switchToPopupBtn" class="tab-mode-btn" title="Switch to Popup" style="display: none;">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,11H7.83L12.41,6.41L11,5L4,12L11,19L12.41,17.59L7.83,13H19V11Z" />
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button class="tab-btn" data-tab="categorize">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="7" height="7" rx="1"></rect>
          <rect x="14" y="3" width="7" height="7" rx="1"></rect>
          <rect x="14" y="14" width="7" height="7" rx="1"></rect>
          <rect x="3" y="14" width="7" height="7" rx="1"></rect>
        </svg>
        Current
        <span class="tab-badge" id="categorizeBadge" style="display: none;"></span>
      </button>
      <button class="tab-btn" data-tab="saved">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
        </svg>
        Saved
        <span class="tab-badge" id="savedBadge" style="display: none;"></span>
      </button>
      <button class="tab-btn" data-tab="settings">
        <svg viewBox="0 0 1024 1024" fill="currentColor">
          <path d="M600.704 64a32 32 0 0 1 30.464 22.208l35.2 109.376c14.784 7.232 28.928 15.36 42.432 24.512l112.384-24.192a32 32 0 0 1 34.432 15.36L944.32 364.8a32 32 0 0 1-4.032 37.504l-77.12 85.12a357.12 357.12 0 0 1 0 49.024l77.12 85.248a32 32 0 0 1 4.032 37.504l-88.704 153.6a32 32 0 0 1-34.432 15.296L708.8 803.904c-13.44 9.088-27.648 17.28-42.368 24.512l-35.264 109.376A32 32 0 0 1 600.704 960H423.296a32 32 0 0 1-30.464-22.208L357.696 828.48a351.616 351.616 0 0 1-42.56-24.64l-112.32 24.256a32 32 0 0 1-34.432-15.36L79.68 659.2a32 32 0 0 1 4.032-37.504l77.12-85.248a357.12 357.12 0 0 1 0-48.896l-77.12-85.248A32 32 0 0 1 79.68 364.8l88.704-153.6a32 32 0 0 1 34.432-15.296l112.32 24.256c13.568-9.152 27.776-17.408 42.56-24.64l35.2-109.312A32 32 0 0 1 423.232 64H600.64zm-23.424 64H446.72l-36.352 113.088-24.512 11.968a294.113 294.113 0 0 0-34.816 20.096l-22.656 15.36-116.224-25.088-65.28 113.152 79.68 88.192-1.92 27.136a293.12 293.12 0 0 0 0 40.192l1.92 27.136-79.808 88.192 65.344 113.152 116.224-25.024 22.656 15.296a294.113 294.113 0 0 0 34.816 20.096l24.512 11.968L446.72 896h130.688l36.48-113.152 24.448-11.904a288.282 288.282 0 0 0 34.752-20.096l22.592-15.296 116.288 25.024 65.28-113.152-79.744-88.192 1.92-27.136a293.12 293.12 0 0 0 0-40.256l-1.92-27.136 79.808-88.128-65.344-113.152-116.288 24.96-22.592-15.232a287.616 287.616 0 0 0-34.752-20.096l-24.448-11.904L577.344 128zM512 320a192 192 0 1 1 0 384 192 192 0 0 1 0-384zm0 64a128 128 0 1 0 0 256 128 128 0 0 0 0-256z"/>
        </svg>
        Settings
      </button>
    </div>
    
    <!-- Unified Toolbar -->
    <div id="unifiedToolbar" class="unified-toolbar">
      <!-- First Row -->
      <div class="toolbar-row first-row">
        <!-- Left: Categorize button (Current Tab) -->
        <div class="toolbar-section left-section">
          <div id="currentTabControls" class="tab-specific-controls">
            <button id="categorizeBtn" class="primary-btn" title="Categorize & Save tabs">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7" rx="1"></rect>
                <rect x="14" y="3" width="7" height="7" rx="1"></rect>
                <rect x="14" y="14" width="7" height="7" rx="1"></rect>
                <rect x="3" y="14" width="7" height="7" rx="1"></rect>
              </svg>
              Categorize & Save
            </button>
            <button id="muteAllBtn" class="icon-btn mute-all-btn" title="Mute all audible tabs" disabled>
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              </svg>
            </button>
          </div>
        </div>
        
        <!-- Middle: Group By controls -->
        <div class="toolbar-section middle-section">
          <div class="control-group grouping-group">
            <label>Group by:</label>
            <select id="unifiedGroupingSelect" class="grouping-select">
              <!-- Options will be populated dynamically based on active tab -->
            </select>
            <button id="toggleGroupsBtn" class="icon-btn" title="Collapse/Expand all groups">
              <span class="toggle-arrow">â–¼</span>
            </button>
          </div>
        </div>
        
        <!-- Middle-Right: Granularity buttons (hidden by default) -->
        <div class="toolbar-section middle-right-section">
          <div id="granularityControls" class="control-group granularity-group" style="display: none;">
            <div class="granularity-buttons">
              <button class="granularity-btn" data-granularity="time" title="5 minute intervals">5m</button>
              <button class="granularity-btn" data-granularity="day" title="Daily">Day</button>
              <button class="granularity-btn" data-granularity="week" title="Weekly">Week</button>
              <button class="granularity-btn" data-granularity="month" title="Monthly">Month</button>
            </div>
          </div>
        </div>
        
        <!-- Right: Show All/Export/Import (Saved Tab) and Close All button -->
        <div class="toolbar-section right-section">
          <div id="savedTabControls" class="tab-specific-controls" style="display: none;">
            <div class="control-group export-import-group">
              <button id="exportBtn" class="icon-btn" title="Export saved tabs as CSV">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
              </button>
              <button id="importBtn" class="icon-btn" title="Import tabs from CSV">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="17 8 12 3 7 8"></polyline>
                  <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
              </button>
            </div>
          </div>
          <button id="closeAllBtn2" class="close-all-btn" title="Close all tabs">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Second Row: Search and Category Filters -->
      <div class="toolbar-row second-row">
        <!-- Category filter buttons -->
        <div class="toolbar-section filter-section">
          <div class="control-group category-filter-group">
            <div class="category-filter-buttons">
              <button id="filterImportantBtn" class="filter-btn filter-btn-important active" title="Show Important tabs" data-category="3">
                <svg class="filter-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
              </button>
              <button id="filterUsefulBtn" class="filter-btn filter-btn-useful active" title="Show Useful tabs" data-category="2">
                <svg class="filter-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/>
                </svg>
              </button>
              <button id="filterIgnoreBtn" class="filter-btn filter-btn-ignore" title="Show Ignore tabs" data-category="1">
                <svg class="filter-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="15" y1="9" x2="9" y2="15"/>
                  <line x1="9" y1="9" x2="15" y2="15"/>
                </svg>
              </button>
              <button id="filterUncategorizedBtn" class="filter-btn filter-btn-uncategorized" title="Show Uncategorized tabs" data-category="0">
                <svg class="filter-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                  <line x1="12" y1="17" x2="12" y2="17"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        
        <div class="toolbar-section search-section">
          <input type="text" id="unifiedSearchInput" class="search-input" placeholder="Search tabs...">
          <button id="clearUnifiedSearchBtn" class="clear-search-btn" title="Clear search">Ã—</button>
        </div>
      </div>
    </div>
    
    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Current Tab -->
      <div id="categorizeTab" class="tab-pane">
        <div id="tabsContainer" class="tabs-container" style="display: none;">
          <!-- Content will be populated when viewing current tabs -->
          <div id="currentContent"></div>
        </div>
      </div>
      
      <!-- Saved Tab -->
      <div id="savedTab" class="tab-pane">
        <div id="savedTabsContainer" class="tabs-container">
          <!-- Content will be populated when viewing saved tabs -->
          <div id="savedContent"></div>
        </div>
      </div>
      
      <!-- Settings Tab -->
      <div id="settingsTab" class="tab-pane">
        <div class="settings-content">
          <div class="setting-group">
            <label>Theme:</label>
            <div class="theme-switcher">
              <button class="theme-btn" data-theme="system">System</button>
              <button class="theme-btn" data-theme="light">Light</button>
              <button class="theme-btn" data-theme="dark">Dark</button>
            </div>
          </div>
          
          <div class="setting-group">
            <h3>LLM-Powered Categorization</h3>
            
            <div class="form-field-inline">
              <input type="checkbox" id="useLLMCheckbox" checked>
              <label for="useLLMCheckbox" class="setting-label">
                Enable LLM categorization
                <span class="setting-description">
                  When disabled, the extension will use rule-based categorization (if rules are defined) and eventually ML categorization (if enabled)
                </span>
              </label>
            </div>
            
            <div id="llmSettingsContainer">
              <div class="form-field">
                <label for="providerSelect" class="setting-label">LLM Provider:</label>
                <select id="providerSelect" class="setting-select">
                  <option value="Claude">Claude</option>
                  <option value="OpenAI">OpenAI</option>
                  <option value="Gemini">Gemini</option>
                  <option value="DeepSeek">DeepSeek</option>
                  <option value="Grok">Grok</option>
                </select>
              </div>
              
              <div class="form-field">
                <label for="apiKeyInput" class="setting-label">
                  API Key:
                  <a id="apiKeyLink" href="#" target="_blank" class="api-key-link" title="Get API key">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                      <polyline points="15 3 21 3 21 9"></polyline>
                      <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                  </a>
                </label>
                <input type="password" id="apiKeyInput" class="setting-input" placeholder="Enter API key">
                <button id="saveApiKeyBtn" class="secondary-btn">Save Key</button>
              </div>
              
              <div class="form-field">
                <label for="modelSelect" class="setting-label">Model:</label>
                <select id="modelSelect" class="setting-select">
                  <!-- Models will be populated dynamically -->
                </select>
                <div id="modelPricingInfo" class="setting-help-text"></div>
              </div>
              
              <div class="form-field">
                <label for="promptTextarea" class="setting-label">
                  Custom Prompt:
                  <span id="promptStatus" class="setting-description"></span>
                </label>
                <textarea id="promptTextarea" class="setting-textarea" rows="10" placeholder="Leave empty to use default prompt"></textarea>
                <button id="resetPromptBtn" class="secondary-btn">Reset to Default</button>
              </div>
            </div>
          </div>
          
          <div class="setting-group">
            <div class="form-field-inline">
              <h3>Rule-Based Categorization</h3>
              <button id="restoreDefaultRulesBtn" class="secondary-btn">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                  <path d="M21 3v5h-5"/>
                  <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                </svg>
                Restore Default Rules
              </button>
            </div>
            <p class="setting-description">
              Create rules to automatically categorize tabs.<br>
              <strong>How it works:</strong> Each rule is checked independently. The first matching rule determines the category.<br>
              <strong>Unmatched tabs:</strong> Will be categorized by ML (if enabled) or LLM (if enabled), otherwise placed in "Useful" category.
            </p>
            
            <div id="rulesContainer" class="rules-container">
              <!-- Category: Important (First) -->
              <div class="rule-category-section" data-category="3">
                <div class="rule-category-header" data-collapsed="true">
                  <div class="rule-category-title">
                    <span class="collapse-arrow">â–¼</span>
                    <svg class="category-icon" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    <span>Important</span>
                  </div>
                  <div class="rule-category-actions">
                    <button class="delete-category-btn" data-category="3" title="Delete all rules in this category">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                      </svg>
                    </button>
                    <button class="add-rule-btn" data-category="3" title="Add new rule">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="rules-table-wrapper">
                  <table class="rules-table">
                    <thead>
                      <tr>
                        <th>URL Pattern</th>
                        <th>Regex</th>
                        <th>Title Pattern</th>
                        <th>Regex</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody class="rules-list" data-category="3">
                      <!-- Rules will be populated here -->
                    </tbody>
                  </table>
                  <div class="rules-empty-state" style="display: none;">No rules defined. Click + to add a rule.</div>
                </div>
              </div>
              
              <!-- Category: Useful (Second) -->
              <div class="rule-category-section" data-category="2">
                <div class="rule-category-header" data-collapsed="true">
                  <div class="rule-category-title">
                    <span class="collapse-arrow">â–¼</span>
                    <svg class="category-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>Useful</span>
                  </div>
                  <div class="rule-category-actions">
                    <button class="delete-category-btn" data-category="2" title="Delete all rules in this category">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                      </svg>
                    </button>
                    <button class="add-rule-btn" data-category="2" title="Add new rule">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="rules-table-wrapper">
                  <table class="rules-table">
                    <thead>
                      <tr>
                        <th>URL Pattern</th>
                        <th>Regex</th>
                        <th>Title Pattern</th>
                        <th>Regex</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody class="rules-list" data-category="2">
                      <!-- Rules will be populated here -->
                    </tbody>
                  </table>
                  <div class="rules-empty-state" style="display: none;">No rules defined. Click + to add a rule.</div>
                </div>
              </div>
              
              <!-- Category: Ignore (Third) -->
              <div class="rule-category-section" data-category="1">
                <div class="rule-category-header" data-collapsed="true">
                  <div class="rule-category-title">
                    <span class="collapse-arrow">â–¼</span>
                    <svg class="category-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="15" y1="9" x2="9" y2="15"></line>
                      <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                    <span>Ignore</span>
                  </div>
                  <div class="rule-category-actions">
                    <button class="delete-category-btn" data-category="1" title="Delete all rules in this category">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                      </svg>
                    </button>
                    <button class="add-rule-btn" data-category="1" title="Add new rule">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="rules-table-wrapper">
                  <table class="rules-table">
                    <thead>
                      <tr>
                        <th>URL Pattern</th>
                        <th>Regex</th>
                        <th>Title Pattern</th>
                        <th>Regex</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody class="rules-list" data-category="1">
                      <!-- Rules will be populated here -->
                    </tbody>
                  </table>
                  <div class="rules-empty-state" style="display: none;">No rules defined. Click + to add a rule.</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="setting-group">
            <h3>Machine Learning</h3>
            
            <div class="form-field-inline">
              <input type="checkbox" id="useMLCheckbox" checked>
              <label for="useMLCheckbox" class="setting-label">
                Enable ML categorization
                <span class="setting-description">
                  Learns from your categorization patterns over time
                </span>
              </label>
            </div>
            
            <div id="mlDashboard">
              <!-- ML Status -->
              <div class="ml-card">
                <div class="ml-card-header">
                  <h4 class="ml-card-title">Model Status</h4>
                </div>
                <div id="mlStatusContent">
                  <div class="ml-status-loading ml-card-content">Loading ML status...</div>
                </div>
              </div>
              
              <!-- Training Settings -->
              <div class="ml-card">
                <div class="ml-card-header">
                  <h4 class="ml-card-title">Training Settings</h4>
                </div>
                
                <!-- Early Stopping Patience -->
                <div class="form-field">
                  <label for="mlPatienceSelect" class="setting-label">Training Patience:</label>
                  <select id="mlPatienceSelect" class="setting-select">
                    <option value="30">Very Quick (30 epochs)</option>
                    <option value="60">Quick (60 epochs)</option>
                    <option value="120" selected>Balanced (120 epochs)</option>
                    <option value="240">Patient (240 epochs)</option>
                    <option value="480">Very Patient (480 epochs)</option>
                  </select>
                  <span class="setting-description">How long to wait for improvement before stopping</span>
                </div>
                
                <!-- Batch Size -->
                <div class="form-field">
                  <label for="mlBatchSizeSelect" class="setting-label">Batch Size:</label>
                  <select id="mlBatchSizeSelect" class="setting-select">
                    <option value="16">16 - High exploration</option>
                    <option value="32">32 - More exploration</option>
                    <option value="64" selected>64 - Balanced</option>
                    <option value="128">128 - More stable</option>
                    <option value="256">256 - Very stable</option>
                  </select>
                  <span class="setting-description">Smaller = escape local minima, Larger = stable convergence</span>
                </div>
                
                <!-- Learning Rate -->
                <div class="form-field">
                  <label for="mlLearningRateSelect" class="setting-label">Learning Rate (Advanced):</label>
                  <select id="mlLearningRateSelect" class="setting-select">
                    <option value="0.0001">Very Slow (0.0001)</option>
                    <option value="0.0002">Slow (0.0002)</option>
                    <option value="0.0005" selected>Balanced (0.0005)</option>
                    <option value="0.001">Fast (0.001)</option>
                    <option value="0.002">Very Fast (0.002)</option>
                  </select>
                  <span class="setting-description">How quickly the model learns</span>
                </div>
              </div>
              
              <!-- Training Controls and Progress -->
              <div class="ml-card">
                <div class="ml-card-header">
                  <h4 class="ml-card-title">Training Controls</h4>
                </div>
                <div id="mlTrainingContent">
                  <div class="button-group">
                    <button id="trainModelBtn">Train Model</button>
                    <button id="resetModelBtn">Reset Model</button>
                    <span id="trainingStatus" class="setting-description"></span>
                  </div>
                  
                  <!-- Training Progress Charts -->
                  <div id="trainingChartsContainer" class="training-charts-container" style="display: none;">
                    <!-- Loss Charts -->
                    <div class="dual-chart-container">
                      <h5 class="chart-title">Loss</h5>
                      <div class="chart-pair">
                        <div class="full-chart">
                          <canvas id="lossChartFull" width="300" height="200"></canvas>
                        </div>
                        <div class="recent-chart">
                          <canvas id="lossChartRecent" width="200" height="200"></canvas>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Accuracy Charts -->
                    <div class="dual-chart-container">
                      <h5 class="chart-title">Accuracy</h5>
                      <div class="chart-pair">
                        <div class="full-chart">
                          <canvas id="accuracyChartFull" width="300" height="200"></canvas>
                        </div>
                        <div class="recent-chart">
                          <canvas id="accuracyChartRecent" width="200" height="200"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="setting-group">
            <h3>Categorization Performance</h3>
            <p class="setting-description">Performance tracking for all categorization methods (LLM, Rules, ML Model)</p>
            
            <!-- Trust Weights -->
            <div class="ml-card">
              <div class="ml-card-header">
                <h4 class="ml-card-title">Method Trust Weights</h4>
              </div>
              <div id="mlTrustContent">
                <div class="ml-trust-loading ml-card-content">Loading trust data...</div>
              </div>
            </div>
            
            <!-- Performance Metrics -->
            <div class="ml-card">
              <div class="ml-card-header">
                <h4 class="ml-card-title">Performance Metrics</h4>
              </div>
              <div id="mlPerformanceContent">
                <div class="ml-performance-loading ml-card-content">Loading performance data...</div>
              </div>
            </div>
          </div>
          
          <div class="setting-group">
            <label for="maxTabsInput" class="setting-label">
              Max Tabs to Open at Once:
              <span class="setting-description">(Safety limit)</span>
            </label>
            <input type="number" id="maxTabsInput" class="setting-input" min="1" max="200" placeholder="50">
            <span class="setting-description">
              Default: 50 tabs. Set higher at your own risk.
            </span>
          </div>
          
          <div class="settings-footer">
            <p>
              Â© 2025 AI Tech Knowledge LLC<br>
              <a href="help.html" target="_blank" class="setting-link">Help</a> â€¢ 
              <a href="https://github.com/aitkn/ai-tab-manager/issues" target="_blank" class="setting-link">Support</a> â€¢ 
              <a href="https://github.com/aitkn/ai-tab-manager" target="_blank" class="setting-link">GitHub</a> â€¢ 
              <a href="https://buymeacoffee.com/aitkn" target="_blank" class="setting-link">Support Development</a>
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <div id="apiKeyPrompt" class="api-key-prompt" style="display: none;">
      <p>Please configure your LLM settings first.</p>
      <button id="openSettingsBtn" class="primary-btn">Open Settings</button>
    </div>
    
    <!-- Status messages container -->
    <div id="statusContainer" class="status-container">
      <!-- Individual status messages will be added here dynamically -->
    </div>
  </div>
  
  <!-- Hidden file input for CSV import -->
  <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
  
  <!-- Close All Dialog -->
  <dialog id="closeAllDialog" class="close-all-dialog">
    <div class="dialog-content">
      <h3>You have unsaved tabs. What would you like to close?</h3>
      <div class="dialog-buttons">
        <button class="dialog-btn primary" data-action="saved-only">Saved Only</button>
        <button class="dialog-btn warning" data-action="all-tabs">All Tabs</button>
        <button class="dialog-btn secondary" data-action="cancel">Cancel</button>
      </div>
    </div>
  </dialog>
  
  <!-- Close Unsaved Only Dialog -->
  <dialog id="closeUnsavedDialog" class="close-all-dialog">
    <div class="dialog-content">
      <h3>These tabs have not been saved. Close anyway?</h3>
      <div class="dialog-buttons">
        <button class="dialog-btn warning" data-action="close">Close Tabs</button>
        <button class="dialog-btn secondary" data-action="cancel">Cancel</button>
      </div>
    </div>
  </dialog>
  
  <script src="lib/browser-polyfill.min.js"></script>
  <script src="popup-redirect-loader.js"></script>
  <script src="src/config/config.js"></script>
  <script src="src/data/database.js"></script>
  <script src="lib/morphdom.min.js"></script>
  <script type="module" src="popup.js"></script>
</body>
</html>